CREATE TABLE `affectations` (
  `ID` int NOT NULL AUTO_INCREMENT,
  `ID_Commande` int NOT NULL COMMENT 'Commande concernée',
  `ID_Operateur` int NOT NULL COMMENT 'Opérateur affecté',
  `ID_Poste` int NOT NULL COMMENT 'Poste de travail',
  `ID_Article` int NOT NULL COMMENT 'Article produit',
  `Date_debut` datetime NOT NULL COMMENT 'Début de l''affectation',
  `Date_fin` datetime DEFAULT NULL COMMENT 'Fin de l''affectation',
  `Duree` int DEFAULT NULL COMMENT 'Durée en minutes - calculée par le back-end',
  `Heure_supp` int DEFAULT '0' COMMENT 'Nombre d''heures supplémentaires',
  `Quantite_produite` int DEFAULT '0' COMMENT 'Quantité produite',
  `Date_creation` datetime DEFAULT CURRENT_TIMESTAMP,
  `Date_modification` datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  `Commentaire` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
  `ID_Semaine` int DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `idx_commande` (`ID_Commande`),
  KEY `idx_operateur` (`ID_Operateur`),
  KEY `idx_poste` (`ID_Poste`),
  KEY `idx_article` (`ID_Article`),
  KEY `idx_dates` (`Date_debut`,`Date_fin`),
  KEY `ID_Semaine` (`ID_Semaine`),
  CONSTRAINT `affectations_ibfk_1` FOREIGN KEY (`ID_Commande`) REFERENCES `commandes` (`ID`) ON DELETE RESTRICT,
  CONSTRAINT `affectations_ibfk_2` FOREIGN KEY (`ID_Operateur`) REFERENCES `personnel` (`ID`) ON DELETE RESTRICT,
  CONSTRAINT `affectations_ibfk_3` FOREIGN KEY (`ID_Poste`) REFERENCES `postes` (`ID`) ON DELETE RESTRICT,
  CONSTRAINT `affectations_ibfk_4` FOREIGN KEY (`ID_Article`) REFERENCES `articles` (`ID`) ON DELETE RESTRICT,
  CONSTRAINT `affectations_ibfk_5` FOREIGN KEY (`ID_Semaine`) REFERENCES `semaines` (`ID`) ON DELETE SET NULL,
  CONSTRAINT `check_dates` CHECK (((`Date_fin` is null) or (`Date_fin` > `Date_debut`)))
) ENGINE=InnoDB AUTO_INCREMENT=2849 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci